<app-layout>
  <div class="container-fluid py-4" style="background-color: #f8f9fa; min-height: calc(100vh - 80px);">
    <div class="container-lg">

      <header class="d-flex align-items-center gap-3 pb-4 mb-4 border-bottom">
        <div class="bg-primary p-2 rounded text-white shadow">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path
              d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
          </svg>
        </div>
        <div>
          <h1 class="h3 mb-0 fw-bold">Revisor com Gemini (Angular)</h1>
          <p class="text-muted small mb-0">Correção e estilo via IA</p>
        </div>
      </header>

      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <label class="d-flex align-items-center gap-2 small fw-semibold text-muted mb-0">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path
                  d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                <circle cx="12" cy="12" r="3" />
              </svg>
              <span>Configuração</span>
            </label>
            @if (keyValidated()) {
            <span class="badge bg-success d-flex align-items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 6 9 17l-5-5" />
              </svg>
              Conectado
            </span>
            }
          </div>

          <div class="d-flex flex-column gap-3">
            <div class="d-flex flex-column flex-md-row gap-3 align-items-md-center">
              <div class="flex-fill">
                <label class="form-label small text-muted mb-1">Modelo (Use os marcados com (Free) para grátis)</label>
                <select [value]="selectedModel()" (change)="updateSelectedModel($event)"
                  class="form-select form-select-sm">
                  @for (model of availableModels(); track model.name) {
                  <option [value]="model.name">
                    {{ model.displayName }}
                  </option>
                  }
                </select>
              </div>
            </div>
          </div>

          <!-- <div class="alert alert-info d-flex align-items-start gap-2 mt-3 mb-0 small">
            <div class="d-flex align-items-center gap-1 fw-semibold text-primary">
              <span>Dica:</span>
            </div>
            <span class="mb-0">
              Modelos marcados com <strong>(Free)</strong> são os Flash. Eles são muito mais rápidos e raramente dão
              erro de cota (limite) no plano gratuito. Evite os marcados com <strong>(Pro)</strong> se não tiver uma
              conta paga.
            </span>
          </div> -->
        </div>
      </div>

      <div class="row g-4">

        <div class="col-12 col-md-6">
          <div class="d-flex flex-column gap-3">
            <div class="card shadow-sm">
              <div class="card-header bg-white d-flex justify-content-between align-items-center border-bottom">
                <span class="small fw-semibold text-muted mb-0">Texto Original</span>
                <div class="d-flex align-items-center gap-2">
                  <select [value]="tone()" (change)="updateTone($event)" class="form-select form-select-sm"
                    style="width: auto;">
                    <option value="profissional">Profissional</option>
                    <option value="amigavel">Amigável</option>
                    <option value="academico">Acadêmico</option>
                    <option value="persuasivo">Persuasivo</option>
                  </select>
                  <button (click)="clearInput()" class="btn btn-sm btn-link text-muted p-1" type="button"
                    title="Limpar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21" />
                      <path d="M22 21H7" />
                      <path d="m5 11 9 9" />
                    </svg>
                  </button>
                </div>
              </div>
              <div class="card-body p-0">
                <textarea [value]="inputText()" (input)="updateInputText($event)" placeholder="Digite seu texto..."
                  class="form-control border-0" style="min-height: 300px; resize: none;"></textarea>
              </div>
            </div>

            <button (click)="analyzeText()" [disabled]="loading()" [class]="getButtonClass()" type="button">
              @if (loading()) {
              <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
              <span>Processando...</span>
              } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                <path
                  d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z" />
                <path d="m14 7 3 3" />
                <path d="M5 6v4" />
                <path d="M19 14v4" />
                <path d="M10 2v2" />
                <path d="M7 8H3" />
                <path d="M21 16h-4" />
                <path d="M11 3H9" />
              </svg>
              <span>Revisar Agora</span>
              }
            </button>

            @if (error()) {
            <div class="alert alert-danger d-flex align-items-start gap-2 mb-0">
              <svg class="mt-1 shrink-0" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10" />
                <line x1="12" x2="12" y1="8" y2="12" />
                <line x1="12" x2="12.01" y1="16" y2="16" />
              </svg>
              <span class="mb-0">{{ error() }}</span>
            </div>
            }
          </div>
        </div>

        <div class="col-12 col-md-6">
          <div class="d-flex flex-column gap-3">
            @if (result()) {
            <div class="d-flex flex-column gap-3">
              <div class="card shadow-sm border-primary">
                <div
                  class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center border-primary border-opacity-25">
                  <span class="small fw-bold text-primary d-flex align-items-center gap-2 mb-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M20 6 9 17l-5-5" />
                    </svg>
                    Sugestão
                  </span>
                  <button (click)="copyToClipboard(result()!.correctedText)"
                    class="btn btn-sm btn-link text-primary p-1" type="button" title="Copiar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                      <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
                    </svg>
                  </button>
                </div>
                <div class="card-body">
                  <p class="mb-0" style="white-space: pre-wrap;">{{ result()!.correctedText }}</p>
                </div>
              </div>

              <div class="card shadow-sm">
                <div class="card-body">
                  <div class="mb-3">
                    <h6 class="text-uppercase small fw-bold text-muted mb-2">Tom</h6>
                    <p class="small text-muted fst-italic mb-0">"{{ result()!.toneAnalysis }}"</p>
                  </div>
                  <div>
                    <h6 class="text-uppercase small fw-bold text-muted mb-2">Melhorias</h6>
                    <ul class="list-unstyled mb-0">
                      @for (item of result()!.improvements; track $index) {
                      <li class="d-flex align-items-start gap-2 small mb-2 p-2 bg-light rounded">
                        <svg class="mt-1 text-primary flex-shrink-0" xmlns="http://www.w3.org/2000/svg" width="14"
                          height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                          stroke-linecap="round" stroke-linejoin="round">
                          <path d="M5 12h14" />
                          <path d="m12 5 7 7-7 7" />
                        </svg>
                        <span>{{ item }}</span>
                      </li>
                      }
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            } @else {
            <div class="card shadow-sm d-flex flex-column align-items-center justify-content-center text-muted p-5"
              style="min-height: 300px;">
              <div class="bg-light p-4 rounded-circle mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M5 12h14" />
                  <path d="m12 5 7 7-7 7" />
                </svg>
              </div>
              <h5 class="fw-semibold mb-0">Aguardando Texto</h5>
            </div>
            }
          </div>
        </div>

      </div>
    </div>
  </div>
</app-layout>